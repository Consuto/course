== Example - Voltage Regulators with Line-Drop Compensators ==
To demonstrate the operation of the voltage regulator, we start where we left off with the battery and solar PV model. Relatively speaking, this is a small model with very light loads and if this was the system we a real-life scenario, we wouldn't need to bother with a voltage regulator. So, to make the situation more interesting, two changes were made to the model:
* The line lengths between the houses were increased by a factor of ten.
* The resistance of the overhead lines were increased by a factor of ten.
Both of these changes will result in greater voltage drops for relatively small currents which will make the operation of the voltage regulator more important.

Opening up "dist_sys_voltage_regulator_ldc.glm" shows these two changes to the model with the addition of in the inclusion of a voltage regulator at the head of the feeder (the substation) and an extra recorder to monitor the voltages down branch 1 and the tap position of the voltage regulator. Looking at the configuration for the regulator we see

<pre>
object regulator_configuration {
	name reg_config;
	connect_type 1;
	band_center 122.000;
	band_width 2.0;
	time_delay 15.0;
	raise_taps 16;
	lower_taps 16;
	current_transducer_ratio 1;
	power_transducer_ratio 58;
	compensator_r_setting_A 0.1;
	compensator_x_setting_A 0.1;
	CT_phase "ABC";
	PT_phase "ABC";
	regulation 0.10;
	Control LINE_DROP_COMP;
	control_level INDIVIDUAL;
	Type B;
	tap_pos_A 0;
	tap_pos_B 0;
	tap_pos_C 0;
	}
</pre>

To understand all of these setting requires more time and space than we have here but the model used in GridLAB-D is based on that set out in (xxxxxxx link) Kersting. Without trying to dig into the details, we can look at through these settings and get a rough idea of how the regulator is set-up to work.
*<tt>band_center 122.000</tt> shows that the target voltage is 122 volts (on a 120V  basis).
*<tt>band_width 2.0</tt> shows that we have a +/- 1V tolerance on the 122V target before the regulator operates.
*<tt>time_delay 15.0</tt> shows we are modeling a 15 second time delay every time the regulator actuates. That is, it will take 15 seconds between measuring a need to make a tap change and the tap change going into effect and changing the output voltage.
*<tt>raise_taps 16, lower_taps 16</tt> shows there are a total of 32 tap positions the regulator has to operate over
<tt>regulation 0.10</tt> indicates that a 10% change will occur from neutral (tap position 0) to the extreme lower or upper positions (tap position +/- 16).
<tt>compensator_r_setting_A 1.5, compensator_x_setting_A 3.0(/tt> are the most important. They show that the modeled effective impedance to the end of the line results in a voltage drop of 0.1 + j0.1 volts (on a 120V basis). The units on this are a bit odd but they are very practical; rather than having to measure or calculate the effective impedance to the end of the line, a simple measurement at that point can directly be used in defining the settings for the line-drop compensator.

Running the model shows there are some problems, though. Looking at "voltage_data.csv" shows that when the simulation starts, the voltage regulator is producing an acceptable voltage for all three residences, roughly 122 V. In the afternoon when the load increases the voltage drop on the line also increases and we start seeing lower voltages, down to 116V on the very last house in the branch. During this period, the voltage regulator does not responde, indicating the modeled impedance in the line-drop compensator is set too low. That is, when the load in the circuit increase, the voltage drop modeled by the line-drop compensator is too little and causing the regulator to believe that no response is needed.

To correct this, let's just guess at new values for the line-drop compensator and re-run the simulation.
<pre>
	compensator_r_setting_A 0.8;
	compensator_x_setting_A 0.8;
</pre>
Re-running this simulation shows that the regulator does a much better job of responding the to changing loading conditions on this branch of the feeder and adjusts as the load changes, namely the air-conditioners switching on and off.

== Example - Voltage Regulators with Voltage Sensing ==
With communication systems becoming a more common part of electrical distribution systems new techniques of handling the setting of voltage regulation have arrived. Namely, rather than modeling and estimating the voltage at the end of the line, why not just measure it and send that information back to the voltage regulator? GridLAB-D support just such an operational mode.

Open up "dist_sys_voltage_regulator_sense.glm" and take a look at how the voltage regulator is configured.
<pre>
object regulator {
	name substation_reg;
	phases "ABC";
	sense_node "b1m3_house_meter";
	from substation_meter;
	to feeder_meter;
	configuration reg_config;
	}
	
object regulator_configuration {
	name reg_config;
	connect_type 1;
	band_center 122.000;
	band_width 2.0;
	time_delay 15.0;
	raise_taps 16;
	lower_taps 16;
	CT_phase "A";
	PT_phase "A";
	regulation 0.10;
	Control REMOTE_NODE;
	control_level BANK;
	Type B;
	tap_pos_A 0;
	tap_pos_B 0;
	tap_pos_C 0;
	}
</pre>

The regulator itself now defines a <tt>sense_node</tt> which, as you might guess, is the node at which the voltage will be measured for regulation purposes. The <tt>regulator_configuration</tt> object is simpler with no more compensator settings and the <tt>control</tt> set to <tt>REMOTE_NODE</tt> instead of <tt>LINE_DROP_COMP</tt>. (The <tt>CT_phase</tt>, <tt>PT_phase</tt>, and <tt>control_level</tt> have also been changed to eliminate some extraneous warnings about voltages in phase B and C where there is no load in this system. The example systems we've been using are massively unbalanced which in the real-world would be a seriously problem but in simulation, is something we can safely ignore.)

Running this model produces the following warning in the console:
<pre>
WARNING  [2009-08-08 11:26:03 PDT] : b1m1_house - house:23 is outside of ANSI standards (voltage = 106 percent of nominal 120/240)
WARNING  [2009-08-09 04:30:00 PDT] : last warning message was repeated 127 times
</pre>
As the message indicates, the first house in branch 1 has a voltage that is slightly too high. Opening up "voltage_data.csv" shows this is the case, particularly in the afternoon under heavier loading.

This is not an unexpected result as we are targeting a nominal voltage at the end of the line which might be expected to make the voltage at the beginning of the line too high. In this case, an easily fix would be to change our sense node so that we regulate the middle of the line to a nominal value; the end of the line will be slightly lower and the beginning slightly higher but everybody will stay within an acceptable voltage range.

In the <tt>regulator</tt> object change the sense node to
<pre>
	sense_node "b1m2_house_meter";
</pre>
and re-run the simulation.
The result: no warnings and "voltage_data_.csv" confirms that all three residential voltages are much closer to nominal.

== Capacitors ==

Capacitors are another common device used to help manage the voltage on the distribution system. Particularly during summer days with air-conditions presenting a high inductive load to the system, a significant portion of the current flowing over the distribution lines is reactive. The default source of this reactive current comes from the substation which can lead to non-trivial voltage drops as the reactive current travels to and from the reactive loads in the distribution system. By providing an alternative source of reactive power closer to the loads (capacitors) the magnitude of the current flowing from the substation is reduced and the voltage profile of the feeder generally improves.

GridLAB-D provides the ability to add capacitors to the distribution system and to also control when they are switched into and out of the feeder. There are a few different control modes defined for the capacitor including manual control (constantly in or out or able to switched using a <tt>schedule</tt> or <tt>player</tt>, voltage-based, or reactive power based (VAR). Like the voltage regulator, the capacitors can either be switched individually or on a per-phase basis.

=== Example - Voltage-based capacitor switching ===
Open up "dist_sys_capacitor.glm" and take a look at the capacitor that has been added to the model.

<pre>
object capacitor {
	phases ABC;				
	name b1m3_capacitor;
	pt_phase ABC;				
	parent branch_1_meter_3;
	phases_connected ABC;		
	control VOLT;
	voltage_set_low 6900.0;
	voltage_set_high 7100.0;
	capacitor_A 10.0 kVAr;
	capacitor_B 10.0 kVAr;
	capacitor_C 10.0 kVAr;
	control_level INDIVIDUAL;
	switchA OPEN;
	switchB OPEN;
	switchC OPEN;
	time_delay 2.0;
	dwell_time 10;
	nominal_voltage 7216.88;
}
</pre>

We can see that the control mode has been set to <tt>VOLT</tt> and that this 10 kVAR capacitor (per phase) has been parented to <tt>branch_1_meter_3</tt> at the end of the branch 1 line. Since the <tt>remote_sense</tt> property has been unspecified, the capacitor will use its own local voltage to determine when the switch; in this case when the voltage falls below 6900 V it will switch in and when it rises above 7100 V it will switch out. <tt>time_delay</tt> is used to model the amount of time it will take for the switching to take place once it has been commanded (2 seconds in this case), and <tt>dwell_time</tt> requires the switching condition be met for the specified period of time (10 seconds) before the switching operation is commanded. Between the two, the time between when the switching condition is met and when the switching will take place is twelve seconds.

Running this model in GridLAB-D produces "voltage_data.csv" (among others) which contains a record of the capacitor switch state and the measured voltage at the <tt>branch_1_meter_3</tt> node. As can be seen, when the voltage drops below 6900 V the capacitor switches in, the voltage rises, and capacitor switches out and the voltage drops. We can also see the delay caused by the <tt>time_delay</tt> and <tt>dwell_time</tt> parameter values.

(xxxxxxx add graph)
